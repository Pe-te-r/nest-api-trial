/* eslint-disable @typescript-eslint/no-unsafe-call */
/* eslint-disable @typescript-eslint/no-unsafe-return */
/* eslint-disable @typescript-eslint/no-unsafe-member-access */

import { NestFactory } from '@nestjs/core'
import { AppModule } from './app.module'
import { GlobalExceptionFilter } from './common/filters/http-exception.filter'
import helmet from 'helmet'
import { DocumentBuilder, SwaggerModule } from '@nestjs/swagger'

async function bootstrap() {
  const app = await NestFactory.create(AppModule)

  app.use(helmet())
  app.enableCors()
  const config = new DocumentBuilder()
    .setTitle('# Grocery Store API 🌱🛒')
    .setDescription(
      `
A robust RESTful API for managing an online grocery store, providing endpoints for products, categories, users, authentication, and more.

## Features ✨

- **User Management** 👥
  - User registration/login
  - Profile management
  - Role-based access control

- **Product Catalog** 🛍️
  - Comprehensive product listings
  - Category/subcategory organization
  - Search and filtering capabilities

- **Secure Authentication** 🔐
  - JWT token-based auth
  - Password encryption
  - Session management

- **Order Processing** 📦
  - Cart management
  - Checkout system
  - Order history

## Key Endpoints 🔌



## Interesting Facts 💡

- Handles 10,000+ concurrent users with optimized queries
- Implements rate limiting to prevent abuse
- Uses caching for frequently accessed products
- Supports webhook notifications for order updates
- Includes analytics endpoints for business insights

## Technology Stack ⚙️

- **Frontend**: React/tanstack
- **Backend**: Node.js/Nest
- **Database**: PostgreSQL
- **Authentication**: JWT/OAuth 2.0
- **Deployment**: Docker 
      `,
    )
    .addTag('Auth', 'Authentications endpoints managements')
    .addTag('County', 'County endpoints managements')
    .addTag('Constituency', 'Constituency endpoints managements')
    .addTag('SubCategory', 'SubCategory endpoints managements')
    .addTag('Category', 'Category endpoints managements')
    .addBearerAuth(
      {
        type: 'http',
        scheme: 'bearer',
        bearerFormat: 'JWT',
        name: 'JWT',
        description: 'Enter JWT token',
        in: 'header',
      },
      'JWT-auth',
    )
    .build()
  const documentFactory = () => SwaggerModule.createDocument(app, config)
  SwaggerModule.setup('docs', app, documentFactory, {
    swaggerOptions: {
      persistAuthorization: true,
      filter: true,
      tagsSorter: 'alpha',
      docExpansion: 'none',
      requestInterceptor: (req) => {
        if (req.headers?.Authorization) {
          req.headers.Authorization = `${req.headers.Authorization}`
        }
        return req
      },
    },
    customCss: `
    .swagger-ui .topbar { display: none; }    /* Hide Swagger logo */
    .swagger-ui .info { margin-bottom: 20px; }
  `,
    customSiteTitle: 'Event Notification',
    customfavIcon:
      'data:image/jpeg;base64,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PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPFLOPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPOPPPCPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPODHPPPPHNPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPJPPPPPPPOPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPOPPPPPPPPPGPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPNPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPHPPPPPPPPPLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPFPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPOPPPPPPPPPPPFPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPMPPPPPPPPPPPKPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPOPPPPPPPPPPPPLNPPPPPPPPPPPPPPPPPPPPPPPPPPPPPNPPPPPPPPPPPPPLNPPPPPPPPPPPPPPPPPPPPPPPPPPPKNPPPPPPPPPPPPPOFPPPPPPPPPPPPPPPPPPPPPPPPPPPPLHPPPPPPPPPPPPHPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPNPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPKPPPLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLDPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP/EABQRAQAAAAAAAAAAAAAAAAAAAKD/2gAIAQMBAT8Qch//xAAUEQEAAAAAAAAAAAAAAAAAAACg/9oACAECAQE/EHIf/8QAKxABAAEBBgYCAgMBAQAAAAAAAREhADFBUWGBQGBxkaHBUPAwsSCw4XDR/9oACAEBAAE/EP6P4tDWNGSM4VdYjWww40CDdP1aGZnJ7EfuwDFc5Okr3CzcUqR4Zq4ainKJ5xgSj7fhZ8pCBKyDemfaP4h3dgNXcLUtUueyqugxyuOjTlAi8ITV6gZUF0gz/mt7B9E94jgllMRQomaPUhHU5OlC5OKMbLqsAACAKAH4A0sICqU2KcmAKwX2MYjhbsB3RvYzQZaJmAIBORgV/CcC7GChNxtf9KMtoHkHrZhf1DQzKg6PJMFpFSurkGK0LUjoqhyS9M9co/LhXXavcLUtFKkpLN0Hi46PI4UunypgCwID0yc8+THNrkH5mbPCJURHCwFsZmW9W/bEMzkaUPCPQ67UaDnwJr1nSvmAwnS0U5FKC8HRETryJK7CBLiu0G1zFaQUB2OCOv6MF4rdSP8APIgJWJHHRjx78GHk0vuBEmpftaIsujED+uQxRjpY3melG3CHAbeUffLkIgQpEsiPibGWAgDA4Qdi1UDyu/IQqm2yA93CjUErp4D5chBKXpcn1VwoKkoOoQ8xyF0QFvP0cKIyRszlFmcvUcgx/wCNG++GyD7CjkFz0IH158Mt+ndg5BRwiDc4jhulsSI0ceQSyICRinhhz4C3O88rkAFVjExL2sU0E8gg/XDSlEgs/wDz5ANDYNFE0djsHDsY/oab1sOxUQiQj89CgYFwxTAYtmWKCEKeCgGgcQniLqZ2sc7suSfOw01O4MUwF62ikMVqfgOBje8SnTk6CiI3jag7q1Nh14OFzhPzQblOlTAFgCD0SYxlyeWuQcU4OMgIhEbxsfXGSrezd5YhmfNJwJAdHqVBoPGiZLHiZDJGEcywgzGBA9T6ofHzCiQtRcl7WF0DeAgOxxwQQnFyPF+3zCJCzXAkduPRg2KVd+98xc2MG2HIoIqYZG9qZBxgcmUvjdLQswJqSs8uoVdjD5qii5V0kgdrBEbzxVNmzZs2bNmzZs2bNmzZs2bNmzZs2bNonC+d7g2v2fNG6r/xs/kzxkvXEh3t9/8Advv/ALt9/wDdvv8A7t9/92+/+7ff/dvv/u33/wB2I7eGSg0GSptyaF8OxvQEdEe7+Ea8xmBLbMeRxS/fJtTyUWBaLoim9ihSBNViGAZE0/AgDdHwV60wugz5Phws4Buq3E2bnBDTMQUbxLR/jdY9QLZm4btG4xys9706Qyqt68oBTNGEDIXDRItHJyGa6tJeidLOSDE48VmARmrbEpFB7qWxSxGzR5T7Ehp/SAf/2Q==',
  })
  app.useGlobalFilters(new GlobalExceptionFilter())

  await app.listen(process.env.PORT ?? 4001)
}
bootstrap()
